<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="_boardWeb">

	<!-- 게시물 목록용-->
	<sql id="boardListBody">
	/*_boardWeb : board-sqlmap.xml : boardListBody */
		SELECT  A.DOMAIN_CD                 AS domainCd
		      , A.BBS_CD                    AS bbsCd
          , A.BBSCTT_SEQ                AS bbscttSeq
          , A.REFRN_SEQ                 AS refrnSeq
          , A.BBSCTT_ORDR_NO            AS bbscttOrdrNo
          , A.BBSCTT_DP                 AS bbscttDp
          , A.CTG_CD                    AS ctgCd
          , (SELECT CTG_NM FROM OP_BOARD_CTG 
              WHERE DOMAIN_CD = A.DOMAIN_CD 
                AND BBS_CD = A.BBS_CD 
                AND CTG_CD = A.CTG_CD)    AS ctgNm
          , DECODE (A.NOTICE_BBSCTT_AT, 'Y', 'Y', 'N')       AS noticeBbscttAt
          <if test="cutTitleNum != null  and cutTitleNum != ''">
          , SUBSTRB(A.BBSCTT_SJ, 0, (#{cutTitleNum} * 2))   AS bbscttSj
          </if>
          <if test="cutTitleNum == null or cutTitleNum == ''">
          , A.BBSCTT_SJ                 AS bbscttSj
          </if>
          , LENGTH(A.BBSCTT_SJ)        AS bbscttSjLength
          , A.BBSCTT_CN                 AS bbscttCn 
          , A.CN_SUMRY                  AS cnSumry
          , A.FILE_SEQ                  AS fileSeq
          , A.RDCNT                     AS rdCnt
          , TO_CHAR(A.REPLY_DT,'YYYY.MM.DD HH24:MI') AS replyDt
			    , A.ACCUSE_CNT                AS accuseCnt
          , A.RECOMEND_CNT              AS recomendCnt
          , A.IP_ADRES                  AS ipAdres
          , A.BRWSR_AGENT               AS brwsrAgent
          , A.OTHBC_AT                  AS othbcAt
          , A.BANNED_WRD_AT            AS bannedWordAt
          , DECODE(A.REGIST_PASSWORD, '', 'N', 'Y') AS registPassword
          , A.REGISTER_NM               AS registerNm
          , A.REGIST_ID                 AS registId
          , A.USER_KEY                  AS userKey
          , TO_CHAR(A.REGIST_DT,'YYYY.MM.DD HH24:MI') AS registDt
          , A.UPDT_ID                   AS updtId
          , TO_CHAR(A.UPDT_DT, 'YYYY/MM/DD') AS updtDt
          , A.MNGR_ID                   AS mngrId
          , A.MNGR_NM                   AS mngrNm
          , A.DEPT_CODE                 AS deptCode
          , A.DEPT_NM                   AS deptNm
          , TO_NUMBER(TO_CHAR(SYS_DATE, 'YYYYMMDD') - TO_CHAR(A.REGIST_DT, 'YYYYMMDD')) AS passDay
			  	, A.ESTN_COLUMN1              AS estnColumn1
          , A.ESTN_COLUMN2              AS estnColumn2
          , A.ESTN_COLUMN3              AS estnColumn3
          , A.ESTN_COLUMN4              AS estnColumn4
          <choose>
          <when test="bbsCd == '1010'">
          , (CASE
          <!-- 선정한 댓글이 있는경우(무조건) = 완료 -->
          				WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'Y'                              THEN 'Y'
          <!-- 선정한 댓글이 없고, 종료일이 지났을경우 = 미완료-->
          				WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &gt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL    THEN 'N'
          <!-- 선정한 댓글이 없고, 종료일이 안지났을경우 = 대기중-->
                  WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &lt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL   THEN 'S'
             ELSE ''
             END)                  AS estnColumn5
          , TO_CHAR(TO_TIMESTAMP(ESTN_COLUMN6,  'YYYYMMDDHH24MISS'), 'YYYY.MM.DD HH24:MI' ) AS estnColumn6
          </when>
          <otherwise>
          , A.ESTN_COLUMN5              AS estnColumn5
          , A.ESTN_COLUMN6              AS estnColumn6
          </otherwise>
          </choose>
          , A.ESTN_COLUMN7              AS estnColumn7
          , A.ESTN_COLUMN8              AS estnColumn8
          , A.ESTN_COLUMN9              AS estnColumn9
          , A.ESTN_COLUMN10             AS estnColumn10
          , A.MNGR_DELETE_AT            AS mngrDeleteAt
          , A.REPLY_ID                  AS replyId
          <if test="bbsCd == '1010'">
          , (CASE
                <!-- 선정한 댓글이 있는경우(무조건) = 완료 -->
                     WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'Y'                              THEN 'COM'
                <!-- 선정한 댓글이 없고, 종료일이 지났을경우 = 미완료-->
                     WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N'  AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &gt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL   THEN 'INC'
                <!-- 선정한 댓글이 없고, 종료일이 안지났을경우 = 진행중-->
                     WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &lt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL   THEN 'PRO'
                     ELSE ''
                  END)                      AS bizProgression
          </if>
          , A.GOODS_CODE				AS goodsCd
          , A.GOODS_NAME				AS goodsNm
		FROM  (SELECT DISTINCT * FROM OP_BOARD) A
        <if test="q_searchType != null  and q_searchType != ''">
	        <if test="q_searchType == 1005">, OP_NTT_TAG B</if>
	        <if test="q_searchType == 1007 or q_searchType == 1010">, OP_NTT_CMT C</if>
        </if>
         WHERE A.BBS_CD = #{bbsCd}
           AND A.MNGR_DELETE_AT = 'N'
        <if test="q_domainCdAll !='0'"> 
            <if test="q_domainCd != null  and q_domainCd != ''">
               AND A.DOMAIN_CD IN (<foreach collection="q_domainCd" item="item" separator=", ">#{item}</foreach>)
            </if>
        </if>
        <if test="q_domainCd == null  or q_domainCd == ''">
           AND A.DOMAIN_CD = #{domainCd}
        </if>
        <if test="q_searchType != null  and q_searchType != ''">
            <if test="q_searchType == 1005">
                AND A.DOMAIN_CD = B.DOMAIN_CD
                AND A.BBS_CD = B.BBS_CD
                AND A.BBSCTT_SEQ = B.BBSCTT_SEQ
            </if>
            <if test="q_searchType == 1007 or q_searchType == 1010">
                AND A.DOMAIN_CD = C.DOMAIN_CD
                AND A.BBS_CD = C.BBS_CD
                AND A.BBSCTT_SEQ = C.BBSCTT_SEQ
            </if>
        </if>
        
    </sql>

	<!-- 검색 (searchType에 따라서 조건이 변경됨)-->
    <sql id="searchDynamic">
        <trim>
            <if test="bizProgression != null  and bizProgression != ''">  <!-- 비즈매칭 진행상태 검색 -->
                <!-- 선정한 댓글이 있는경우(무조건) = 완료 -->
                <if test="bizProgression == 'COM'">
                    AND SUBSTR (ESTN_COLUMN5,0,1) = 'Y'
                </if>
                <!-- 선정한 댓글이 없고, 종료일이 지났을경우 = 미완료-->
                <if test="bizProgression == 'INC'">
                    AND SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &gt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL
                </if>
                <!-- 선정한 댓글이 없고, 종료일이 안지났을경우 = 진행중-->
                <if test="bizProgression == 'PRO'">
                    AND SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &lt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL
                </if>
            </if>
            <if test="registId != null  and registId != ''"> <!--아이디 검색 -->
                AND A.REGIST_ID = #{registId}
            </if>
            <if test="q_product != null  and q_product != ''"> <!-- 서비스 검색 -->
                AND SUBSTRING(A.estn_Column7,INSTR(A.estn_Column7, '_',1)+1 )  = #{q_product}
            </if>
            <if test="q_ctgCd != null  and q_ctgCd != ''"> <!-- 부류코드1 검색 -->
                AND A.CTG_CD = #{q_ctgCd}
            </if>
            <if test="q_aditCtgCd != null  and q_aditCtgCd != ''"><!-- 부류코드2 검색 -->
                AND A.ESTN_COLUMN1 = #{q_aditCtgCd}
            </if>
            <if test="q_othbcAt != null  and q_othbcAt != ''"> <!-- 공개여부 검색 -->
                AND A.OTHBC_AT = #{q_othbcAt}
            </if>
            <if test="q_estnColumn3 != null  and q_estnColumn3 != ''"><!-- Q&A답변상태 검색 -->
                AND A.ESTN_COLUMN3 = #{q_estnColumn3}
            </if>
            <if test="q_estnColumn5 != null  and q_estnColumn5 != ''"><!-- 비즈매칭선정여부 검색 -->
                <!-- 대기중은 S이므로 조건이 다르게 검색되어야함 -->
                <choose>
                    <when test='q_estnColumn5 == "N"'>
                        AND SUBSTR (ESTN_COLUMN5,0,1) = #{q_estnColumn5}
                        AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &gt; ESTN_COLUMN6
                        AND ESTN_COLUMN6 IS NOT NULL
                    </when>
                    <when test='q_estnColumn5 == "S"'>
                        AND SUBSTR (ESTN_COLUMN5,0,1) = #{q_estnColumn5}
                        AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &lt; ESTN_COLUMN6
                        AND ESTN_COLUMN6 IS NOT NULL
                    </when>
                    <otherwise>
                        AND SUBSTR (ESTN_COLUMN5,0,1) = #{q_estnColumn5}
                    </otherwise>
                </choose>
            </if>
            <if test="q_searchVal != null  and q_searchVal != ''">
                <if test="q_searchType == 1001">
                    AND A.${q_searchKey} = #{q_searchVal}
                </if>
                <if test="q_searchType == 1002">
                   AND A.${q_searchKey} LIKE '%' || #{q_searchVal} || '%'
                </if>
                <if test="q_searchType == 1003">
                   AND A.${q_searchKey} &lt;= #{q_searchVal}
                </if>
                <if test="q_searchType == 1004">
                   AND A.${q_searchKey} &gt;= #{q_searchVal}
                </if>
                <if test="q_searchType == 1005">
                    AND B.TAG_NM = #{q_searchVal}
                </if>
                <if test="q_searchType == 1006"> <!-- 제목+내용 -->
                    AND (A.BBSCTT_SJ LIKE '%' || #{q_searchVal} || '%'  OR A.BBSCTT_CN LIKE '%' || #{q_searchVal} || '%')
                </if>
                <if test="q_searchType == 1007"> <!-- 댓글 등록자명 -->
                    AND C.REGISTER_NM LIKE '%' || #{q_searchVal} || '%'
                </if>
                <if test="q_searchType == 1008">  <!-- 등록자명+ 아이디 -->
                    AND (A.REGISTER_NM LIKE '%' || #{q_searchVal} || '%'  OR A.REGIST_ID LIKE '%' || #{q_searchVal} || '%')
                </if>
                <if test="q_searchType == 1009"><!-- 팝업 서비스검색 -->
                    AND I.GOODS_NM LIKE '%' || #{q_searchVal} || '%'
                </if>
                <if test="q_searchType == 1010"> <!-- 댓글 등록자명+ 댓글아이디 -->
                    AND C.NTT_CMT_CN LIKE '%' || #{q_searchVal} || '%'  
                </if>
                <if test="q_searchType == 1011"> <!-- 사례명-->
                    AND (A.BBSCTT_SJ LIKE '%' || #{q_searchVal} || '%')
                </if>
                <if test="q_searchType == 1012"> <!-- 내용 -->
                    AND (A.BBSCTT_CN LIKE '%' || #{q_searchVal} || '%')
                </if>
                <if test="q_searchType == 1013"> <!-- 서비스명-->
                    AND (A.GOODS_NAME LIKE '%' || #{q_searchVal} || '%')
                </if>
            </if>
            <if test='bannedWordAt != null  and bannedWordAt != "" and bannedWordAt == "N"'>
                AND A.BANNED_WRD_AT = 'N'
            </if>
            <if test="q_startDt != null  and q_startDt != ''">
                AND TO_CHAR( A.REGIST_DT, 'YYYYMMDDHHMISS' ) &gt;= #{q_startDt}
            </if>
            <if test="q_endDt != null  and q_endDt != ''">
                AND TO_CHAR( A.REGIST_DT, 'YYYYMMDDHHMISS' ) &lt;= #{q_endDt}
            </if>
        </trim>
    </sql>

	<!-- 공지를 포함하지 않는 정렬 -->
    <sql id="sortDynamic">
        <trim>
	        <if test="q_sortName != null  and q_sortName != ''">
	           <if test="q_sortName == 'ROWNUM'">
	               ORDER BY A.REFRN_SEQ ${q_sortOrder}, A.BBSCTT_ORDR_NO ASC
	           </if>
	           <if test="q_sortName != 'ROWNUM'">
	              ORDER BY A.${q_sortName} ${q_sortOrder}, A.REGIST_DT DESC
	           </if>
	        </if>
	        <if test="q_sortName == null or q_sortName == ''">
	            ORDER BY A.REGIST_DT DESC, A.REFRN_SEQ DESC, A.BBSCTT_ORDR_NO ASC
	        </if>
        </trim>
    </sql>

	<!-- 공지를 포함한 정렬 -->
    <sql id="sortDynamicAll">
        <trim>
            <choose>
                <when test="bbsCd == '1001'">
                    ORDER BY A.CTG_CD ASC, A.ESTN_COLUMN1 DESC ,A.REGIST_DT DESC 
                </when>
                <otherwise>
                    <if test="q_sortName != null  and q_sortName != ''">
                   <if test="q_sortName == 'ROWNUM'">
                       ORDER BY A.NOTICE_BBSCTT_AT DESC, A.REFRN_SEQ ${q_sortOrder}, A.BBSCTT_ORDR_NO
                   </if>
                   <if test="q_sortName == 'ROWNUM'">
                      ORDER BY A.${q_sortName} ${q_sortOrder}, A.REGIST_DT DESC
                   </if>
                </if>
                <if test="q_sortName == null or q_sortName == ''">
                    ORDER BY A.NOTICE_BBSCTT_AT DESC, A.REGIST_DT DESC, A.REFRN_SEQ DESC, A.BBSCTT_ORDR_NO ASC
                </if>
                </otherwise>
            </choose>
        </trim>
    </sql>
    

	<!-- 공지가 아닌 게시물 목록 -->
    <select id="boardList" parameterType="java.util.Map" resultMap="Select">
    /*_boardWeb : board-sqlmap.xml : boardList */
        SELECT  Z.*
              , (SELECT COUNT(F.FILE_ORDR_NO)
                   FROM OP_FILE F
                  WHERE F.FILE_SEQ = Z.fileSeq) AS fileCnt
              , (SELECT SUM(F.DWLD_CNT)
                   FROM OP_FILE F
                  WHERE F.FILE_SEQ = Z.fileSeq) AS downCnt
              , (SELECT COUNT(C.BBS_CD)
                   FROM OP_NTT_CMT C
                  WHERE C.DOMAIN_CD = #{domainCd} 
                    AND C.BBS_CD = #{bbsCd}       
                    AND C.BBSCTT_SEQ = Z.bbscttSeq) AS commentCnt
            <if test="bbsCd == '1008'">
              ,(SELECT 
                    I.GOODS_NM 
                FROM 
                    TST_GOOD_ORDR_I O, 
                    TST_GOOD_INFO_I I 
                WHERE O.GOODS_CODE = I.GOODS_CODE
                    AND O.ORDRR_ID = Z.registId
                    AND I.MNGR_DELETE_AT ='N' 
                    AND I.GOODS_ACTVTY_AT ='Y' 
                    AND I.GOODS_REGIST_STTUS = 1006 
                    AND I.LANG_CODE = #{langCode} 
                    AND O.ORDER_CNFIRM_AT = 'Y'
                    AND O.PURCHS_NO = SUBSTRING(Z.estnColumn7,0,INSTR(Z.estnColumn7, '_',1)-1 )
                ) AS goodsNm 
            </if>
        FROM (SELECT Y.* 
                FROM (SELECT  ROWNUM NUM
                            , X.* 
                        FROM  (
	                    <include refid="boardListBody"/>
	                    <trim>
	                        <if test="noticeBbscttAt != null  and noticeBbscttAt != ''">
	                            AND A.NOTICE_BBSCTT_AT = 'N'
	                        </if>
	                    </trim>
	                    <include refid="searchDynamic"/>
	                    GROUP BY A.BBSCTT_SEQ
	                    <include refid="sortDynamic"/>
                    ) X
                WHERE ROWNUM &lt;= #{pagingEndNum}
             ) Y
             WHERE NUM &gt;= #{pagingStartNum} ) Z
    </select>

	<!-- 공지 목록 -->
	<select id="noticeList" parameterType="java.util.Map" resultType="boardVO">
    /*_boardWeb : board-sqlmap.xml : noticeList */
        SELECT
            Z.*
            , (SELECT COUNT(F.FILE_ORDR_NO)
                  FROM OP_FILE F
                 WHERE F.FILE_SEQ = Z.fileSeq) AS fileCnt
            , (SELECT SUM(F.DWLD_CNT)
             FROM OP_FILE F
            WHERE F.FILE_SEQ = Z.fileSeq) AS downCnt
            , (SELECT COUNT(C.BBS_CD)
                  FROM OP_NTT_CMT C
                 WHERE C.DOMAIN_CD = #{domainCd}
                   AND C.BBS_CD = #{bbsCd}
                   AND C.BBSCTT_SEQ = Z.bbscttSeq) AS commentCnt
        FROM (
            SELECT Y.* FROM (
                SELECT ROWNUM NUM, X.* FROM (
	                SELECT DISTINCT * FROM (
	                    <include refid="boardListBody"/>
	                       AND A.NOTICE_BBSCTT_AT = 'Y'
	                    <include refid="searchDynamic"/>
	                      ORDER BY A.REFRN_SEQ DESC, A.BBSCTT_ORDR_NO
	                      )
                    ) X
                WHERE ROWNUM &lt;= #{pagingEndNum}
             ) Y
             WHERE NUM &gt;= #{pagingStartNum} ) Z
        ORDER BY refrnSeq DESC, bbscttOrdrNo ASC
    </select>

	<!-- 게시물 갯수 페이져용 -->
	<select id="boardListCount" parameterType="java.util.Map" resultType="int"> 
    /*_boardWeb : board-sqlmap.xml : boardListCount */
        SELECT COUNT(X.BBSCTT_SEQ) AS totalCount
        FROM(
          SELECT DISTINCT A.BBSCTT_SJ, A.BBSCTT_SEQ
          FROM OP_BOARD A
        <if test="q_searchType != null  and q_searchType != ''">
            <if test="q_searchType == 1005">
                , OP_NTT_TAG B
            </if>
        </if>
        <if test="q_searchType != null  and q_searchType != ''">
            <if test="q_searchType == 1007 or q_searchType == 1010">
                , OP_NTT_CMT C
            </if>
        </if>
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
           AND A.MNGR_DELETE_AT = 'N'
         <if test="q_searchType != null  and q_searchType != ''">
            <if test="q_searchType == 1005">
                AND A.DOMAIN_CD = B.DOMAIN_CD
                AND A.BBS_CD = B.BBS_CD
                AND A.BBSCTT_SEQ = B.BBSCTT_SEQ
            </if>
            <if test="q_searchType == 1007 or q_searchType == 1010 ">
                AND A.DOMAIN_CD = C.DOMAIN_CD
                AND A.BBS_CD = C.BBS_CD
                AND A.BBSCTT_SEQ = C.BBSCTT_SEQ
            </if>
        </if>
           AND A.NOTICE_BBSCTT_AT = #{noticeBbscttAt}
           <include refid="searchDynamic"/>
           ) X
    </select>

	<!-- 전체 게시물 갯수 boardConf에서 삭제시 확인 -->
	<select id="boardTotalListCount" parameterType="java.util.Map" resultType="int">
    /*_boardWeb : board-sqlmap.xml : boardTotalListCount */
        SELECT COUNT(A.BBSCTT_SEQ) AS totalCount
          FROM OP_BOARD A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD    = #{bbsCd}
    </select>

	<!-- excel, pdf 컨버전용 -->
	<select id="boardAllList" parameterType="java.util.Map" resultType="boardVO">
    /*_boardWeb : board-sqlmap.xml : boardAllList */
        SELECT
            Z.*
            , (SELECT COUNT(F.FILE_ORDR_NO)
                  FROM OP_FILE F
                 WHERE F.FILE_SEQ = Z.fileSeq) AS fileCnt
            , (SELECT COUNT(C.BBS_CD)
                  FROM OP_NTT_CMT C
                 WHERE C.DOMAIN_CD  = #{domainCd}
                   AND C.BBS_CD     = #{bbsCd}
                   AND C.BBSCTT_SEQ = Z.bbscttSeq) AS commentCnt
        FROM (
            SELECT Y.* FROM (
                SELECT ROWNUM NUM, X.* FROM (
                    <include refid="boardListBody"/>
                    <include refid="searchDynamic"/>
                    <include refid="sortDynamicAll"/>
                    ) X
            <trim>
                <if test="pagingEndNum != null  and pagingEndNum != ''">
                WHERE ROWNUM &lt;= #{pagingEndNum}
                   </if>
             ) Y
                <if test="pagingStartNum != null  and pagingStartNum != ''">
             WHERE NUM &gt;= #{pagingStartNum} 
                   </if>
            </trim>
            ) Z
    </select>

	<!-- 게시물 댓글포함 갯수 -->
	<select id="getBoardCount" parameterType="boardVO" resultType="int">
    /*_boardWeb : board-sqlmap.xml : getBoardCount */
        SELECT 
            COUNT(A.BBSCTT_SEQ) AS totalCount
          FROM OP_BOARD A
         WHERE A.DOMAIN_CD  = #{domainCd}
           AND A.BBS_CD     = #{bbsCd}
           AND A.BBSCTT_SEQ = #{bbscttSeq}
    </select>

	<!-- 게시판 최근 목록 -->
    <select id="boardRecentList" parameterType="java.util.Map" resultType="boardVO">
    /*_boardWeb : board-sqlmap.xml : boardRecentList */
        SELECT * FROM (
            SELECT
                  DOMAIN_CD             AS domainCd
                , BBS_CD                AS bbsCd
                , BBSCTT_SEQ            AS bbscttSeq
                , SUBSTRB(BBSCTT_SJ, 0, (#{cutTitleNum} * 2)) AS bbscttSj
                , ${cutTitleNum}        AS cutTitleNum
                , LENGTHB(BBSCTT_SJ)    AS bbscttSjLength
                , TO_CHAR(REGIST_DT,'YYYY-MM-DD') AS registDt
              FROM OP_BOARD
             WHERE DOMAIN_CD = #{domainCd}
               AND BBS_CD = #{bbsCd}
             ORDER BY REGIST_DT DESC
        ) WHERE ROWNUM &lt;= #{rowNum}
    </select>

	<!-- 게시판 최근 목록(데모용) -->
	<select id="boardRecentListAll" parameterType="java.util.Map" resultType="boardVO">
    /*_boardWeb : board-sqlmap.xml : boardRecentListAll */
        SELECT * FROM (
            SELECT
                  DOMAIN_CD             AS domainCd
                , (SELECT BBS_NM FROM OP_BOARD_CONF OBC WHERE OBC.BBS_CD = OB.BBS_CD) bbsNm
                ,  BBS_CD               AS bbsCd
                ,  BBSCTT_SEQ           AS bbscttSeq
                ,  SUBSTRB(BBSCTT_SJ, 0, (#cutTitleNum# * 2)) AS bbscttSj
                ,  $cutTitleNum$        AS cutTitleNum
                ,  LENGTHB(BBSCTT_SJ)   AS bbscttSjLength
                ,  TO_CHAR(REGIST_DT,'YYYY-MM-DD') AS registDt
                ,  CN_SUMRY             AS cnSumry
                ,  FILE_SEQ             AS fileSeq
              FROM OP_BOARD OB
             WHERE DOMAIN_CD = #{domainCd}
                   <!-- BBS_CD = #bbsCd# -->
             ORDER BY REGIST_DT DESC
        ) WHERE ROWNUM &lt;= #{rowNum}
    </select>


    <resultMap id="Select" type="boardVO">
        <collection property="ctgryList" column="{estnColumn8=estnColumn8,estnColumn9=estnColumn9,estnColumn10=estnColumn10}" ofType="boardVO" select="ctgrySelect"/>
    </resultMap>
    <!-- 비즈매칭 구분값 가져오기 -->
    <select id="ctgrySelect"  parameterType="boardVO" resultType="boardVO">
		/*_boardWeb : board-sqlmap.xml : ctgrySelect */ 
        SELECT
                A.CTGRY_CODE  AS ctgryCode,
                (SELECT INDVDLZ_CD_NM
                   FROM OP_CODE_INDVDLZ
                  WHERE GROUP_CD = 1005
                    AND LANG_CODE = A.LANG_CODE
                    AND INDVDLZ_CD = A.CTGRY_CL_CD) AS ctgryClNm,         
                (SELECT SYS_CONNECT_BY_PATH(B.LANG_CTGRY_NM, ' > ')
                   FROM TST_CATE_MGMT_M B
                  WHERE B.CTGRY_CODE = A.CTGRY_CODE                       
             START WITH B.PARNTS_CTGRY_CODE = '0'
       CONNECT BY PRIOR B.CTGRY_CODE = B.PARNTS_CTGRY_CODE  ) AS ctgryPath
          FROM TST_CATE_MGMT_M A
         WHERE A.CTGRY_DELETE_AT = 'N'    
           AND A.CTGRY_CODE IN (#{estnColumn8},#{estnColumn9},#{estnColumn10})
           ORDER BY A.CTGRY_CODE DESC
    </select>
    
	<!-- 게시물 보기 -->
	<select id="boardView" parameterType="boardVO" resultMap="Select">
		/*_boardWeb : board-sqlmap.xml : boardView */ 
		SELECT 
			  A.DOMAIN_CD           AS domainCd
            , A.BBS_CD              AS bbsCd
            , A.BBSCTT_SEQ          AS bbscttSeq
            , A.REFRN_SEQ           AS refrnSeq
            , A.BBSCTT_ORDR_NO      AS bbscttOrdrNo
            , A.BBSCTT_DP           AS bbscttDp
            , A.CTG_CD              AS ctgCd
			,(SELECT CTG_NM 
                FROM OP_BOARD_CTG 
                WHERE DOMAIN_CD = A.DOMAIN_CD
                  AND BBS_CD = A.BBS_CD 
                  AND CTG_CD = A.CTG_CD) AS ctgNm
            , DECODE(A.NOTICE_BBSCTT_AT, 'Y', 'Y', 'N') AS noticeBbscttAt
			, A.BBSCTT_SJ           AS bbscttSj
            , A.BBSCTT_CN           AS bbscttCn
            , A.CN_SUMRY            AS cnSumry
            , A.REPLY_ID            AS replyId
            , A.REPLY_CN            AS replyCn
            , TO_CHAR(A.REPLY_DT,'YYYY.MM.DD HH24:MI') AS replyDt
			, A.FILE_SEQ            AS fileSeq
            , A.RDCNT               AS rdCnt
            , A.RECOMEND_CNT        AS recomendCnt
            , A.ACCUSE_CNT          AS accuseCnt
            , A.IP_ADRES            AS ipAdres
            , A.BRWSR_AGENT         AS brwsrAgent
            , A.OTHBC_AT            AS othbcAt
            , A.BANNED_WRD_AT       AS bannedWordAt
            , A.REGIST_ID           AS registId
            , A.REGISTER_NM         AS registerNm
            , A.REGIST_PASSWORD     AS registPassword
            , A.UPDT_ID             AS updtId
			, (SELECT MNGR_NM   
                FROM OP_MNGR 
                WHERE MNGR_ID = A.UPDT_ID)  AS modNm
            , TO_CHAR(A.REGIST_DT,'YYYY.MM.DD HH24:MI') AS registDt
            , TO_CHAR(A.UPDT_DT,'YYYY.MM.DD HH24:MI')   AS updtDt
			, A.MNGR_ID             AS mngrId
            , A.DEPT_CODE           AS deptCode
            , A.DEPT_NM             AS deptNm
            , A.MNGR_NM             AS mngrNm
            , A.USER_KEY            AS userKey
            , A.ESTN_COLUMN1        AS estnColumn1
            , A.ESTN_COLUMN2        AS estnColumn2
            , A.ESTN_COLUMN3        AS estnColumn3
            , A.ESTN_COLUMN4        AS estnColumn4
			 <choose>
                 <when test="bbsCd == '1010'">
                 , (CASE
                    <!-- 선정한 댓글이 있는경우(무조건) = 완료 -->
                         WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'Y'                              THEN 'Y'
                    <!-- 선정한 댓글이 없고, 종료일이 지났을경우 = 미완료-->
                         WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &gt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL   THEN 'N'
                    <!-- 선정한 댓글이 없고, 종료일이 안지났을경우 = 대기중-->
                         WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &lt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL   THEN 'S'
                         ELSE ''
                      END)   AS estnColumn5
                 , SUBSTR (ESTN_COLUMN5,3)  AS bizCmtSeq
                 , TO_CHAR(TO_TIMESTAMP(ESTN_COLUMN6,  'YYYYMMDDHH24MISS'), 'YYYY.MM.DD HH24:MI' ) AS estnColumn6
                 </when>
                 <otherwise>
                     , A.ESTN_COLUMN5        AS estnColumn5
			         , A.ESTN_COLUMN6        AS estnColumn6
                 </otherwise>
             </choose>
            , A.ESTN_COLUMN7        AS estnColumn7
            , A.ESTN_COLUMN8        AS estnColumn8
            , A.ESTN_COLUMN9        AS estnColumn9
            , A.ESTN_COLUMN10       AS estnColumn10
            <if test="bbsCd == '1010'">
             , (CASE
                <!-- 선정한 댓글이 있는경우(무조건) = 완료 -->
                     WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'Y'                              THEN 'COM'
                <!-- 선정한 댓글이 없고, 종료일이 지났을경우 = 미완료-->
                     WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &gt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL   THEN 'INC'
                <!-- 선정한 댓글이 없고, 종료일이 안지났을경우 = 진행중-->
                     WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &lt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL   THEN 'PRO'
                     ELSE ''
                  END)   AS bizProgression
              </if>
            , (SELECT COUNT(BBS_CD)
               FROM OP_NTT_CMT
               WHERE DOMAIN_CD = #{domainCd}
                 AND BBS_CD = #{bbsCd}
                 AND BBSCTT_SEQ = A.BBSCTT_SEQ) AS commentCnt
            , A.MNGR_DELETE_AT      AS mngrDeleteAt
            <if test="bbsCd == '1008'">
              ,(SELECT 
                    I.GOODS_NM 
                FROM 
                    TST_GOOD_ORDR_I O, 
                    TST_GOOD_INFO_I I 
                WHERE O.GOODS_CODE = I.GOODS_CODE
                    AND O.ORDRR_ID = A.REGIST_ID
                    AND I.MNGR_DELETE_AT ='N' 
                    AND I.GOODS_ACTVTY_AT ='Y' 
                    AND I.GOODS_REGIST_STTUS = 1006 
                    AND I.LANG_CODE = #{langCode} 
                    AND O.ORDER_CNFIRM_AT = 'Y'
                    AND O.PURCHS_NO = SUBSTRING(A.ESTN_COLUMN7,0,INSTR(A.ESTN_COLUMN7, '_',1)-1 )
                ) AS goodsNm 
            </if>
          FROM OP_BOARD A
		 WHERE A.BBS_CD = #{bbsCd}
           AND A.BBSCTT_SEQ = #{bbscttSeq}
           AND A.DOMAIN_CD = #{domainCd}
	</select>

	<!-- 게시물 등록 -->
	<insert id="boardInsert" parameterType="boardVO">
		/*_boardWeb : board-sqlmap.xml : boardInsert */
		INSERT INTO OP_BOARD (
             DOMAIN_CD
           , BBS_CD
           , BBSCTT_SEQ
           , REFRN_SEQ
           , BBSCTT_ORDR_NO
           , BBSCTT_DP
           , CTG_CD
           , NOTICE_BBSCTT_AT
           , BBSCTT_SJ
           , BBSCTT_CN
           , CN_SUMRY
           , FILE_SEQ
           , IP_ADRES
           , BRWSR_AGENT
           , OTHBC_AT
           , BANNED_WRD_AT
           , REGIST_PASSWORD
           , REGISTER_NM
           , REGIST_ID
           , REGIST_DT
           , USER_KEY
           , ESTN_COLUMN1
           , ESTN_COLUMN2
           , ESTN_COLUMN3
           , ESTN_COLUMN4
           , ESTN_COLUMN5
           , ESTN_COLUMN6
           , ESTN_COLUMN7
           , ESTN_COLUMN8
           , ESTN_COLUMN9
           , ESTN_COLUMN10
		) VALUES (
             #{domainCd} 
           , #{bbsCd}
           , #{bbscttSeq}
           , #{refrnSeq}
           , #{bbscttOrdrNo}
           , #{bbscttDp}
           , #{ctgCd}
           , #{noticeBbscttAt}
           , #{bbscttSj}
           , #{bbscttCn}
           , NVL(#{cnSumry},' ')
           , #{fileSeq}
           , #{ipAdres}
           , #{brwsrAgent}
           , #{othbcAt}
           , #{bannedWordAt}
           , #{registPassword}
           , #{registerNm}
           , #{registId}
           , SYS_DATETIME
           , #{userKey}
           , #{estnColumn1}
           , #{estnColumn2}
           , #{estnColumn3}
           , #{estnColumn4}
           , #{estnColumn5}
           , #{estnColumn6}
           , #{estnColumn7}
           , #{estnColumn8}
           , #{estnColumn9}
           , #{estnColumn10}
        )
	</insert>

	<!-- 게시물 첫번째 자식-->
	<select id="boardMinChildNode" parameterType="boardVO" resultType="boardVO">
		/* _boardWeb.boardMinChildNode */
		SELECT
             DOMAIN_CD          AS domainCd
           , BBS_CD             AS bbsCd
           , BBSCTT_SEQ         AS bbscttSeq
           , REFRN_SEQ          AS refrnSeq
           , BBSCTT_ORDR_NO     AS bbscttOrdrNo
           , BBSCTT_DP          AS bbscttDp
        FROM
            OP_BOARD
        WHERE DOMAIN_CD = #{domainCd}
          AND BBS_CD = #{bbsCd}
          AND REFRN_SEQ = #{refrnSeq}
          AND BBSCTT_ORDR_NO = 
                (SELECT NVL(MIN(BBSCTT_ORDR_NO), #{bbscttOrdrNo}) 
                    FROM OP_BOARD
                 WHERE DOMAIN_CD = #{domainCd} 
                   AND BBS_CD = #{bbsCd}
                   AND REFRN_SEQ = #{refrnSeq}
                   AND BBSCTT_ORDR_NO &gt; #{bbscttOrdrNo}
                   AND BBSCTT_DP = (#{bbscttDp} - 1) )
	</select>

	<!-- 게시물 마지막 자식-->
	<select id="boardMaxChildNode" parameterType="boardVO" resultType="boardVO">
	/*_boardWeb : board-sqlmap.xml : boardMaxChildNodSSbbscttOrdrNoe */
        SELECT
             DOMAIN_CD          AS domainCd
           , BBSCTT_SEQ         AS bbscttSeq
           , BBS_CD             AS bbsCd
           , REFRN_SEQ          AS refrnSeq
           , BBSCTT_ORDR_NO     AS bbscttOrdrNo
           , BBSCTT_DP          AS bbscttDp
        FROM
            OP_BOARD
        WHERE DOMAIN_CD = #{domainCd} 
          AND BBS_CD = #{bbsCd}
          AND REFRN_SEQ = #{refrnSeq}
          AND BBSCTT_ORDR_NO =
              (SELECT NVL(MAX(BBSCTT_ORDR_NO), #{bbscttOrdrNo}) 
                FROM OP_BOARD
               WHERE DOMAIN_CD = #{domainCd} 
                  AND BBS_CD = #{bbsCd} 
                  AND REFRN_SEQ =  #{refrnSeq}
                  AND BBSCTT_ORDR_NO &gt; #{bbscttOrdrNo}
                  AND BBSCTT_DP &gt; #{bbscttDp} )
	</select>

	<!-- 게시물 마지막 자식-->
    <select id="boardMmaxOrderNo" parameterType="boardVO" resultType="int">
    /*_boardWeb : board-sqlmap.xml : boardMmaxOrderNo */
        SELECT NVL(MAX(BBSCTT_ORDR_NO),0)
          FROM OP_BOARD
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
    </select>

    <!-- 게시물 하위 자식들 OrderNo 1증가 -->
    <update id="boardUpdateOrderNo" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : boardUpdateOrderNo */
        UPDATE OP_BOARD
           SET BBSCTT_ORDR_NO = BBSCTT_ORDR_NO + 1
        WHERE DOMAIN_CD = #{domainCd}
          AND BBS_CD    = #{bbsCd}
          AND REFRN_SEQ   = #{refrnSeq}
          AND BBSCTT_ORDR_NO &gt; #{bbscttOrdrNo}
    </update>

    <!-- 게시물 ReadCnt 1증가 -->
    <update id="boardIncRdCnt" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : boardIncRdCnt */
        UPDATE OP_BOARD
           SET RDCNT = RDCNT + 1
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
    </update>

    <!-- 평점 1증가 -->
    <update id="scoreInc" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : scoreInc */
        UPDATE OP_BOARD
           SET STSFDG_EVL_CNT = STSFDG_EVL_CNT + 1,
               SCORE_SUM = SCORE_SUM + #{scoreSum}
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD    = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
    </update>

    <!-- 추천 1증가 -->
    <update id="recommInc" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : recommInc */
        UPDATE OP_BOARD
           SET RECOMEND_CNT = RECOMEND_CNT + 1
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
    </update>

    <!-- 신고 1증가 -->
    <update id="accuseInc" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : accuseInc */
        UPDATE OP_BOARD
           SET ACCUSE_CNT = ACCUSE_CNT + 1
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
    </update>
    
    <!-- 민원형 게시판 답변 등록 수정 -->
    <update id="boardAnswerUpdate" parameterType="boardVO">
    /*_board : board-sqlmap.xml : boardAnswerUpdate */
        UPDATE OP_BOARD 
           SET REPLY_ID      = #{replyId}
             , REPLY_CN      = #{replyCn}
             , REPLY_DT      = SYS_DATETIME
             , UPDT_DT       = SYS_DATETIME
             , ESTN_COLUMN3  = #{estnColumn3} 
             , OTHBC_AT      = #{othbcAt} 
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
    </update>

    <!-- 민원형 게시판 답변 등록 수정 -->
    <update id="boardAnswerUpdateOld" parameterType="boardVO">
    /*_board : board-sqlmap.xml : boardAnswerUpdateOld */
        UPDATE OP_BOARD SET
            REPLY_CN  = #{replyCn},
            REPLY_DT = SYS_DATETIME,
            OTHBC_AT = #{othbcAt},
            <if test="mngrNm != null  and mngrNm != ''">
                MNGR_NM = #{mngrNm},
            </if>
            <if test="deptCode != null  and deptCode != ''">
                DEPT_CODE = #{deptCode},
           </if>
           <if test="deptNm != null  and deptNm != ''">
                DEPT_NM = #{deptNm},
           </if>
           <if test="estnColumn1 != null  and estnColumn1 != ''">
                   ESTN_COLUMN1 = #{estnColumn1},
           </if>
           <if test="estnColumn2 != null  and estnColumn2 != ''">
                   ESTN_COLUMN2 = #{estnColumn2},
           </if>
           <if test="estnColumn3 != null  and estnColumn3 != ''">
                   ESTN_COLUMN3 = #{estnColumn3},
           </if>
           <if test="estnColumn4 != null  and estnColumn4 != ''">
                   ESTN_COLUMN4 = #{estnColumn4},
           </if>
           <if test="estnColumn5 != null  and estnColumn5 != ''">
                   ESTN_COLUMN5 = #{estnColumn5},
           </if>
           <if test="estnColumn6 != null  and estnColumn6 != ''">
                   ESTN_COLUMN6 = #{estnColumn6},
           </if>
           <if test="estnColumn7 != null  and estnColumn7 != ''">
                   ESTN_COLUMN7 = #{estnColumn7},
           </if>
           <if test="estnColumn8 != null  and estnColumn8 != ''">
                   ESTN_COLUMN8 = #{estnColumn8},
           </if>
           <if test="estnColumn9 != null  and estnColumn9 != ''">
                   ESTN_COLUMN9 = #{estnColumn9},
           </if>
           <if test="estnColumn10 != null  and estnColumn10 != ''">
                   ESTN_COLUMN10 = #{estnColumn10},
           </if>
            UPDT_DT = SYS_DATETIME
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
    </update>

	<!-- 게시물 수정 -->
    <update id="boardUpdate" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : boardUpdate */
        UPDATE OP_BOARD
          <set>
           <if test="bbscttSj != null  and bbscttSj != ''">
                BBSCTT_SJ = #{bbscttSj},
           </if>
           <if test="bbscttCn != null  and bbscttCn != ''">
                BBSCTT_CN = #{bbscttCn},
           </if>
           <if test="cnSumry != null  and cnSumry != ''">
                CN_SUMRY = #{cnSumry},
           </if>
           <if test="replyCn != null  and replyCn != ''">
                REPLY_CN = #{replyCn},
                REPLY_DT = TO_CHAR(SYS_DATETIME, 'YYYYMMDDhh24miSss'),
           </if>
           <if test="ctgCd != null  and ctgCd != ''">
                CTG_CD = #{ctgCd},
           </if>
           <if test="noticeBbscttAt != null  and noticeBbscttAt != ''">
                NOTICE_BBSCTT_AT = #{noticeBbscttAt},
           </if>
           <if test="registPassword != null  and registPassword != ''">
                REGIST_PASSWORD = #{registPassword},
           </if>
           <if test="registerNm != null  and registerNm != ''">
                REGISTER_NM = #{registerNm},
           </if>
                 <if test="fileSeq &gt; 0">
                     FILE_SEQ = #{fileSeq},
                 </if>
           <if test="othbcAt != null  and othbcAt != ''">
                OTHBC_AT = #{othbcAt},
           </if>
           <if test="bannedWordAt != null  and bannedWordAt != ''">
                BANNED_WRD_AT = #{bannedWordAt},
           </if>
           <if test="estnColumn1 != null  and estnColumn1 != ''">
               ESTN_COLUMN1 = #{estnColumn1},
           </if>
           <if test="estnColumn2 != null  and estnColumn2 != ''">
               ESTN_COLUMN2 = #{estnColumn2},
           </if>
           <if test="estnColumn3 != null  and estnColumn3 != ''">
               ESTN_COLUMN3 = #{estnColumn3},
           </if>
           <if test="estnColumn4 != null  and estnColumn4 != ''">
               ESTN_COLUMN4 = #{estnColumn4},
           </if>
           <if test="estnColumn5 != null  and estnColumn5 != ''">
               ESTN_COLUMN5 = #{estnColumn5},
           </if>
           <if test="estnColumn6 != null  and estnColumn6 != ''">
               ESTN_COLUMN6 = #{estnColumn6},
           </if>
           <if test="estnColumn7 != null  and estnColumn7 != ''">
               ESTN_COLUMN7 = #{estnColumn7},
           </if>
           <if test="estnColumn8 != null  and estnColumn8 != ''">
               ESTN_COLUMN8 = #{estnColumn8},
           </if>
           <if test="estnColumn9 != null  and estnColumn9 != ''">
               ESTN_COLUMN9 = #{estnColumn9},
           </if>
           <if test="estnColumn10 != null  and estnColumn10 != ''">
               ESTN_COLUMN10 = #{estnColumn10},
           </if>
               UPDT_ID = #{updtId},
               UPDT_DT = SYS_DATETIME
         </set>
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
    </update>

	<!-- 게시물 목록에서 여러개 삭제시 -->
    <select id="deleteBoardList" parameterType="boardVO" resultType="boardVO">
    /*_boardWeb : board-sqlmap.xml : deleteBoardList */
        SELECT 
               A.DOMAIN_CD          AS domainCd
             , A.BBS_CD             AS bbsCd
             , A.BBSCTT_SEQ         AS bbscttSeq
             , A.BBSCTT_SJ          AS bbscttSj
             , A.FILE_SEQ           AS fileSeq
             , A.REFRN_SEQ          AS refrnSeq
             , A.BBSCTT_ORDR_NO     AS bbscttOrdrNo
             , A.BBSCTT_DP          AS bbscttDp
          FROM OP_BOARD A 
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
           AND A.REFRN_SEQ = #{refrnSeq}
           AND A.BBSCTT_SEQ &gt;= #{bbscttSeq}
           AND A.BBSCTT_ORDR_NO &gt;= #{bbscttOrdrNo}
           AND A.BBSCTT_ORDR_NO &lt;= #{bbscttDp}
    </select>

    <!-- 게시물 보기에서 하나 삭제 -->
    <delete id="boardDelete" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : boardDelete */
        DELETE FROM OP_BOARD
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ    = #{bbscttSeq}
    </delete>

	<!-- 삭제 데이터 보관 -->
    <insert id="trashBoardInsert" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : trashBoardInsert */
        INSERT INTO OP_BOARD_TRASH (
            DOMAIN_CD
          , BBS_CD
          , BBSCTT_SEQ
          , REFRN_SEQ
          , BBSCTT_ORDR_NO
          , BBSCTT_DP
          , CTG_CD
          , NOTICE_BBSCTT_AT
          , BBSCTT_SJ
          , BBSCTT_CN
          , CN_SUMRY
          , REPLY_CN
          , REPLY_DT
          , REPLY_ID
          , MNGR_NM
          , MNGR_ID
          , MNGR_DELETE_AT
          , DEPT_CODE
          , DEPT_NM
          , FILE_SEQ
          , RDCNT
          , ACCUSE_CNT
          , RECOMEND_CNT
          , IP_ADRES
          , BRWSR_AGENT
          , OTHBC_AT
          , BANNED_WRD_AT
          , USER_KEY
          , REGIST_PASSWORD
          , REGISTER_NM
          , REGIST_ID
          , REGIST_DT
          , UPDT_ID
          , UPDT_DT
          , ESTN_COLUMN1
          , ESTN_COLUMN2
          , ESTN_COLUMN3
          , ESTN_COLUMN4
          , ESTN_COLUMN5
          , ESTN_COLUMN6
          , ESTN_COLUMN7
          , ESTN_COLUMN8
          , ESTN_COLUMN9
          , ESTN_COLUMN10
          , STDR_YM
        )
        SELECT
            DOMAIN_CD
          , BBS_CD
          , BBSCTT_SEQ
          , REFRN_SEQ
          , BBSCTT_ORDR_NO
          , BBSCTT_DP
          , CTG_CD
          , NOTICE_BBSCTT_AT
          , BBSCTT_SJ
          , BBSCTT_CN
          , CN_SUMRY
          , REPLY_CN
          , REPLY_DT
          , REPLY_ID
          , MNGR_NM
          , MNGR_ID
          , MNGR_DELETE_AT
          , DEPT_CODE
          , DEPT_NM
          , FILE_SEQ
          , RDCNT
          , ACCUSE_CNT
          , RECOMEND_CNT
          , IP_ADRES
          , BRWSR_AGENT
          , OTHBC_AT
          , BANNED_WRD_AT
          , USER_KEY
          , REGIST_PASSWORD
          , REGISTER_NM
          , REGIST_ID
          , REGIST_DT
          , UPDT_ID
          , UPDT_DT
          , ESTN_COLUMN1
          , ESTN_COLUMN2
          , ESTN_COLUMN3
          , ESTN_COLUMN4
          , ESTN_COLUMN5
          , ESTN_COLUMN6
          , ESTN_COLUMN7
          , ESTN_COLUMN8
          , ESTN_COLUMN9
          , ESTN_COLUMN10
          , TO_CHAR(SYS_DATE,'YYYYMM')
        FROM OP_BOARD
        WHERE DOMAIN_CD = #{domainCd}
          AND BBS_CD = #{bbsCd}
          AND BBSCTT_SEQ = #{bbscttSeq}
    </insert>

	<!-- 삭제 태그 보관 -->
    <insert id="trashTagInsert" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : trashTagInsert */
        INSERT INTO OP_NTT_TAG_TRASH (
            DOMAIN_CD
          , BBS_CD
          , BBSCTT_SEQ
          , TAG_NM
          , STDR_YM
        )
        SELECT
            DOMAIN_CD
          , BBS_CD
          , BBSCTT_SEQ
          , TAG_NM
          , TO_CHAR(SYS_DATE,'YYYYMM')
        FROM OP_NTT_TAG
        WHERE DOMAIN_CD = #{domainCd}
          AND BBS_CD = #{bbsCd}
          AND BBSCTT_SEQ = #{bbscttSeq}
    </insert>

    <!-- 삭제 댓글 보관 -->
    <insert id="trashCommentInsert" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : trashCommentInsert */
        INSERT INTO OP_NTT_CMT_TRASH (
            DOMAIN_CD
          , BBS_CD
          , BBSCTT_SEQ
          , CMT_SEQ
          , REFRN_CMT_SEQ
          , CMT_DP
          , CMT_ORDR_NO
          , ICON_KEY
          , NTT_CMT_CN
          , IP_ADRES
          , USER_KEY
          , USER_DELETE_AT
          , REGIST_PASSWORD
          , REGISTER_NM
          , REGIST_ID
          , REGIST_DT
          , UPDT_ID
          , UPDT_DT
          , BBSCTT_EVL_SCORE
          , MNGR_ID
          , MNGR_DELETE_AT
          , BIZ_MATCHING_OTHBC_AT
          , BIZ_MATCHING_CMPNY_NM
          , BIZ_MATCHING_CTTPC
          , BIZ_MATCHING_EMAIL
          , STDR_YM
          , FILE_SEQ
        ) SELECT
            DOMAIN_CD
          , BBS_CD
          , BBSCTT_SEQ
          , CMT_SEQ
          , REFRN_CMT_SEQ
          , CMT_DP
          , CMT_ORDR_NO
          , ICON_KEY
          , NTT_CMT_CN
          , IP_ADRES
          , USER_KEY
          , USER_DELETE_AT
          , REGIST_PASSWORD
          , REGISTER_NM
          , REGIST_ID
          , REGIST_DT
          , UPDT_ID
          , UPDT_DT
          , BBSCTT_EVL_SCORE
          , MNGR_ID
          , MNGR_DELETE_AT
          , BIZ_MATCHING_OTHBC_AT
          , BIZ_MATCHING_CMPNY_NM
          , DECRYPT(BIZ_MATCHING_CTTPC,'P007')
          , DECRYPT(BIZ_MATCHING_EMAIL,'P008')
          , TO_CHAR(SYS_DATE,'YYYYMM')
          , FILE_SEQ
        FROM OP_NTT_CMT
        WHERE DOMAIN_CD = #{domainCd}
          AND BBS_CD = #{bbsCd}
          AND BBSCTT_SEQ = #{bbscttSeq}
        <if test="cmtSeq != null">
            AND CMT_SEQ = #{cmtSeq}
        </if>
    </insert>

	<!-- 다음글/이전글용 -->
	<sql id="boardSimpleList">
    /*_board : board-sqlmap.xml : boardSimpleList */
        SELECT 
             DOMAIN_CD
           , BBS_CD
           , BBSCTT_SEQ
           , BBSCTT_SJ
           , MNGR_DELETE_AT
           , OTHBC_AT
           , REGIST_PASSWORD
           , FILE_SEQ
           , PASS_DAY
           , ROWNUM AS POS
           , REGISTER_NM
           , REGIST_ID
           , REGIST_DT
           , LENGTHB(BBSCTT_SJ)
           , ESTN_COLUMN3
          FROM (SELECT 
                       A.DOMAIN_CD
                     , A.BBS_CD
                     , A.BBSCTT_SJ
                     , A.BBSCTT_SEQ
                     , A.OTHBC_AT
                     , A.REGIST_PASSWORD
                     , A.MNGR_DELETE_AT
                     , A.FILE_SEQ
                     , A.REGISTER_NM
                     , A.REGIST_ID
                     , A.REGIST_DT
					 , TO_NUMBER(TO_CHAR(SYS_DATE, 'YYYYMMDD') - TO_CHAR(A.REGIST_DT, 'YYYYMMDD')) AS PASS_DAY
				     , LENGTHB(A.BBSCTT_SJ)
                     , A.ESTN_COLUMN3
                  FROM OP_BOARD A
				<if test="q_searchType != null  and q_searchType != ''">
                    <if test="q_searchType == 1005">
                        , OP_NTT_TAG B
                    </if>
                    <if test="q_searchType == 1007 or q_searchType == 1010">
                        , OP_NTT_CMT C
                    </if>
                </if>
                 WHERE A.DOMAIN_CD = #{domainCd}
                   AND A.BBS_CD  = #{bbsCd}
                   AND A.NOTICE_BBSCTT_AT    = #{noticeBbscttAt}
                   AND A.MNGR_DELETE_AT      = 'N'
                <if test="q_searchType != null  and q_searchType != ''">
                    <if test="q_searchType == 1005">
                        AND A.DOMAIN_CD = B.DOMAIN_CD
                        AND A.BBS_CD = B.BBS_CD
                        AND A.BBSCTT_SEQ = B.BBSCTT_SEQ
                    </if>
                    <if test="q_searchType == 1007 or q_searchType == 1010">
                        AND A.DOMAIN_CD = C.DOMAIN_CD
                        AND A.BBS_CD = C.BBS_CD
                        AND A.BBSCTT_SEQ = C.BBSCTT_SEQ
                    </if>
                </if>
                       <include refid="searchDynamic"/>
                       <include refid="sortDynamic"/>
        ) C
    </sql>

	<!-- 다음글 -->
	<select id="boardNextView" parameterType="boardVO" resultType="boardVO">
    /*_boardWeb : board-sqlmap.xml : boardNextView */
        SELECT 
               Z.DOMAIN_CD              AS domainCd
             , Z.BBS_CD                 AS bbsCd
             , Z.BBSCTT_SJ              AS bbscttSj
             , Z.BBSCTT_SEQ             AS bbscttSeq
             , Z.OTHBC_AT               AS othbcAt
             , Z.REGIST_PASSWORD        AS registPassword
             , Z.REGISTER_NM            AS registerNm
             , Z.REGIST_ID              AS registId
             , TO_CHAR(Z.REGIST_DT,'YYYY-MM-DD HH24:MI') AS registDt
             , Z.MNGR_DELETE_AT         AS mngrDeleteAt
             , LENGTHB(Z.BBSCTT_SJ)     AS bbscttSjLength
             , ESTN_COLUMN3             AS estnColumn3
             , (SELECT COUNT(F.FILE_ORDR_NO) 
                FROM OP_FILE F WHERE F.FILE_SEQ = Z.FILE_SEQ) AS fileCnt
             , (SELECT COUNT(C.BBS_CD) 
                FROM 
                    OP_NTT_CMT C 
                WHERE 
                      C.DOMAIN_CD = #{domainCd} 
                  AND C.BBS_CD = #{bbsCd} 
                  AND C.BBSCTT_SEQ = Z.BBSCTT_SEQ) AS commentCnt
             , PASS_DAY AS passDay
          FROM (<include refid="boardSimpleList"/>) Z
         WHERE Z.POS = ( SELECT (X.POS-1)
                           FROM (<include refid="boardSimpleList"/>) X
                          WHERE X.DOMAIN_CD = #{domainCd}
                            AND X.BBSCTT_SEQ = #{bbscttSeq}
                            AND X.BBS_CD = #{bbsCd} )
	</select>

	<!-- 이전글 -->
	<select id="boardPrevView" parameterType="boardVO" resultType="boardVO">
    /*_boardWeb : board-sqlmap.xml : boardPrevView */
        SELECT 
              Z.DOMAIN_CD               AS domainCd
            , Z.BBS_CD                  AS bbsCd
            , Z.BBSCTT_SJ               AS bbscttSj
            , Z.BBSCTT_SEQ              AS bbscttSeq
            , Z.OTHBC_AT                AS othbcAt
            , Z.REGISTER_NM             AS registerNm
            , Z.REGIST_ID               AS registId
            , TO_CHAR(Z.REGIST_DT,'YYYY-MM-DD HH24:MI') AS registDt
            , Z.OTHBC_AT                AS othbcAt
            , Z.REGIST_PASSWORD         AS registPassword
            , Z.MNGR_DELETE_AT          AS mngrDeleteAt
            , LENGTHB(Z.BBSCTT_SJ)      AS bbscttSjLength
            , ESTN_COLUMN3              AS estnColumn3
            , (SELECT COUNT(F.FILE_ORDR_NO) 
                FROM OP_FILE F 
                WHERE F.FILE_SEQ = Z.FILE_SEQ)  AS fileCnt
            , (SELECT COUNT(C.BBS_CD) 
                FROM OP_NTT_CMT C 
                WHERE C.DOMAIN_CD = #{domainCd} 
                  AND C.BBS_CD = #{bbsCd} 
                  AND C.BBSCTT_SEQ = Z.BBSCTT_SEQ) AS commentCnt
            , PASS_DAY       AS passDay
          FROM (<include refid="boardSimpleList"/>) Z
         WHERE Z.POS = ( SELECT (X.POS+1)
                           FROM (<include refid="boardSimpleList"/>) X
                          WHERE X.DOMAIN_CD = #{domainCd}
                            AND X.BBSCTT_SEQ = #{bbscttSeq}
                            AND X.BBS_CD = #{bbsCd} )
    </select>

	<!-- 게시물 댓글 목록 페이징 -->
	<select id="commentList" parameterType="java.util.Map" resultType="boardCmtVO">
    /*_board : board-sqlmap.xml : commentList */
        SELECT
            Z.*
            , Z.registPassword AS registPassword
            , (SELECT MNGR.MNGR_NM FROM OP_MNGR MNGR WHERE Z.mngrId = MNGR.MNGR_ID) AS mngrNm
            , (SELECT USR.USER_NM FROM OP_USER USR WHERE Z.registId = USR.USER_ID) AS userNm
            , (SELECT USR.USER_ID FROM OP_USER USR WHERE Z.registId = USR.USER_ID) AS userId
        FROM (
             SELECT Y.* 
               FROM (
                    SELECT ROWNUM NUM, X.* 
                      FROM (
                            SELECT 
                                   A.DOMAIN_CD                  AS domainCd
                                 , A.BBS_CD                     AS bbsCd
                                 , A.BBSCTT_SEQ                 AS bbscttSeq
                                 , A.CMT_SEQ                    AS cmtSeq
                                 , A.ICON_KEY                   AS iconKey
                                 , A.NTT_CMT_CN                 AS nttCmtCn
                                 , A.REGIST_PASSWORD            AS registPassword
                                 , A.REGIST_ID                  AS registId
                                 , A.REGISTER_NM                AS registerNm
                                 , TO_CHAR(A.REGIST_DT,'YYYY-MM-DD HH24:MI') AS registDt
                                 , A.UPDT_ID                    AS updtId
                                 , TO_CHAR(A.UPDT_DT, 'YYYY-MM-DD HH24:MI') AS updtDt
                                 , A.MNGR_ID                    AS mngrId
                                 , A.BBSCTT_EVL_SCORE           AS bbscttEvlScore
                                 , A.MNGR_DELETE_AT             AS mngrDeleteAt
                                 , A.CMT_ORDR_NO                AS cmtOrdrNo
                                 , A.REFRN_CMT_SEQ              AS refrnCmtSeq
                                 , A.CMT_DP                     AS cmtDp
                                 , A.USER_DELETE_AT             AS userDeleteAt
                                 , A.USER_KEY                   AS userKey
                                 , A.BIZ_MATCHING_CMPNY_NM      AS bizMatchingCmpnyNm
                                 , DECRYPT(A.BIZ_MATCHING_CTTPC,'P007')         AS bizMatchingCttpc
                                 , DECRYPT(A.BIZ_MATCHING_EMAIL,'P008')         AS bizMatchingEmail
                                 , A.BIZ_MATCHING_OTHBC_AT      AS bizMatchingOthbcAt
                                 , FILE_SEQ                     AS fileSeq
                              FROM (
                                   SELECT *
                                     FROM OP_NTT_CMT V
                                    WHERE V.DOMAIN_CD = #{domainCd}
                                      AND V.BBS_CD = #{bbsCd}
                                      AND V.BBSCTT_SEQ = #{bbscttSeq}
                                   ) A
                             START WITH CMT_DP = 0
                           CONNECT BY NOCYCLE  PRIOR CMT_SEQ = REFRN_CMT_SEQ     
                    ) X
                WHERE ROWNUM &lt;= #{pagingEndNum}
             ) Y
             WHERE NUM &gt;= #{pagingStartNum}
        ) Z
    </select>

	<!-- 게시물 댓글 목록 전체 -->
	<select id="commentListAll" parameterType="boardVO" resultType="boardCmtVO">
    /*_boardWeb : board-sqlmap.xml : commentListAll */
        SELECT 
              A.DOMAIN_CD           AS domainCd
            , A.BBS_CD              AS bbsCd
            , A.BBSCTT_SEQ          AS bbscttSeq
            , A.CMT_SEQ             AS cmtSeq
            , A.REGISTER_NM         AS registerNm
            , A.REGIST_ID           AS registId
            , A.REGIST_PASSWORD     AS registPassword
            , A.USER_KEY            AS userKey
            , A.ICON_KEY            AS iconKey
            , A.NTT_CMT_CN          AS nttCmtCn
            , A.BBSCTT_EVL_SCORE    AS bbscttEvlScore
            , A.IP_ADRES            AS ipAdres
            , A.MNGR_ID             AS mngrId
            , A.UPDT_ID             AS updtId
            , TO_CHAR(A.REGIST_DT,'YYYY-MM-DD HH24:MI') AS registDt
            , A.UPDT_DT             AS updtDt
            , A.MNGR_DELETE_AT      AS mngrDeleteAt
            , A.CMT_ORDR_NO         AS cmtOrdrNo
            , A.REFRN_CMT_SEQ       AS refrnCmtSeq
            , A.CMT_DP              AS cmtDp
            , A.USER_DELETE_AT      AS userDeleteAt
          FROM OP_NTT_CMT A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD= #{bbsCd}
           AND A.BBSCTT_SEQ = #{bbscttSeq}
           AND A.CMT_SEQ = #{cmtSeq}
         ORDER BY A.REGIST_DT DESC
    </select>

	<!-- 게시물 댓글 갯수 -->
	<select id="commentListCount" parameterType="java.util.Map" resultType="int">
    /*_boardWeb : board-sqlmap.xml : commentListCount */
        SELECT COUNT(A.BBSCTT_SEQ) AS totalCount
          FROM OP_NTT_CMT A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
         <trim>
           <if test="bbscttSeq != null  and bbscttSeq != ''">
           AND A.BBSCTT_SEQ = #{bbscttSeq}
           </if>
         </trim>
    </select>

	<!-- 게시물 댓글 추가 -->
	<insert id="commentInsert" parameterType="boardCmtVO">
    /*_boardWeb : board-sqlmap.xml : commentInsert */
        <!-- selectKey resultClass="int" keyProperty="cmtSeq">
            SELECT NVL(MAX(CMT_SEQ), 0) + 1
              FROM OP_NTT_CMT
             WHERE BBS_CD = #{bbsCd}
               AND SEQ = #{seq}
        </selectKey -->
        INSERT INTO OP_NTT_CMT (
            DOMAIN_CD
          , BBS_CD        
          , BBSCTT_SEQ    
          , CMT_SEQ    
          , REGISTER_NM        
          , REGIST_ID        
          , REGIST_PASSWORD    
          , REGIST_DT   
          , USER_KEY        
          , ICON_KEY        
          , NTT_CMT_CN        
          , IP_ADRES    
          , BBSCTT_EVL_SCORE
          , MNGR_DELETE_AT
          , CMT_ORDR_NO
          , REFRN_CMT_SEQ
          , CMT_DP
          , USER_DELETE_AT
          , BIZ_MATCHING_CMPNY_NM
          , BIZ_MATCHING_CTTPC
          , BIZ_MATCHING_EMAIL
          , BIZ_MATCHING_OTHBC_AT
          , FILE_SEQ
        ) VALUES (
            #{domainCd}
          , #{bbsCd}    
          , #{bbscttSeq}    
          , #{cmtSeq}    
          , #{registerNm}    
          , #{registId}    
          , #{registPassword}    
          , SYS_DATETIME
          , #{userKey}        
          , #{iconKey}        
          , #{nttCmtCn}        
          , #{ipAdres}    
          , #{bbscttEvlScore}
          , NVL(#{mngrDeleteAt}, 'N')
          , NVL(#{cmtOrdrNo}, 0)
          , #{refrnCmtSeq}
          , NVL(#{cmtDp}, 0)
          , NVL(#{userDeleteAt}, 'N')
          , #{bizMatchingCmpnyNm}
          , ENCRYPT(#{bizMatchingCttpc},'P007')
          , ENCRYPT(#{bizMatchingEmail},'P008')
          , #{bizMatchingOthbcAt}
          , #{fileSeq}
        )
    </insert>
    
    <!-- 코멘트 첫번째 자식-->
    <select id="boardMinCmtChildNode" parameterType="boardCmtVO" resultType="boardCmtVO">
    /*_board : board-sqlmap.xml : boardMinCmtChildNode */
        SELECT 
               DOMAIN_CD        AS domainCd
             , BBS_CD           AS bbsCd
             , BBSCTT_SEQ       AS bbscttSeq
             , CMT_SEQ          AS cmtSeq
             , CMT_ORDR_NO      AS cmtOrdrNo
             , REFRN_CMT_SEQ    AS refrnCmtSeq
             , CMT_DP           AS cmtDp
          FROM OP_NTT_CMT
         WHERE DOMAIN_CD = #{domainCd} 
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
           AND CMT_SEQ = #{cmtSeq}
        <trim>         
            <if test="refrnCmtSeq == null and refrnCmtSeq == ''" >
            AND REFRN_CMT_SEQ = #{cmtSeq}
            </if>
            <if test="refrnCmtSeq != null and refrnCmtSeq != ''" >
            AND REFRN_CMT_SEQ = #{refrnCmtSeq}
            </if>
        </trim>
           AND CMT_ORDR_NO = 
               (SELECT NVL(MIN(CMT_ORDR_NO), #{cmtOrdrNo}) 
                  FROM OP_NTT_CMT
                 WHERE DOMAIN_CD = #{domainCd} 
                   AND BBS_CD = #{bbsCd}
                   AND BBSCTT_SEQ = #{bbscttSeq}
                   AND CMT_SEQ = #{cmtSeq}
                <trim>         
                    <if test="refrnCmtSeq == null and refrnCmtSeq == ''" >
                    AND REFRN_CMT_SEQ = #{cmtSeq}
                    </if>
                    <if test="refrnCmtSeq != null and refrnCmtSeq != ''" >
                    AND REFRN_CMT_SEQ = #{refrnCmtSeq}
                    </if>
                </trim>
                   AND CMT_ORDR_NO &gt; #{cmtOrdrNo}
                   AND CMT_DP = (#{cmtDp} - 1))
    </select>

    <!-- 코멘트 마지막 자식-->
    <select id="boardMaxCmtChildNode" parameterType="boardCmtVO" resultType="boardCmtVO">
    /*_board : board-sqlmap.xml : boardMaxCmtChildNode */
        SELECT DOMAIN_CD        AS domainCd
             , BBS_CD           AS bbsCd
             , BBSCTT_SEQ       AS bbscttSeq
             , CMT_SEQ          AS cmtSeq
             , REFRN_CMT_SEQ    AS refrnCmtSeq
             , CMT_DP           AS cmtDp
             , CMT_ORDR_NO      AS cmtOrdrNo
          FROM OP_NTT_CMT
         WHERE DOMAIN_CD = #{domainCd} 
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
           AND CMT_SEQ = #{cmtSeq}
        <trim>         
           <if test="refrnCmtSeq == null and refrnCmtSeq == ''" >
           AND REFRN_CMT_SEQ = #{cmtSeq}
           </if>
           <if test="refrnCmtSeq != null and refrnCmtSeq != ''" >
           AND REFRN_CMT_SEQ = #{refrnCmtSeq}
           </if>
        </trim>
           AND CMT_ORDR_NO =
               (SELECT NVL(MAX(CMT_ORDR_NO), #{cmtOrdrNo}) 
                  FROM OP_NTT_CMT
                 WHERE DOMAIN_CD = #{domainCd} 
                   AND BBS_CD = #{bbsCd}
                   AND BBSCTT_SEQ = #{bbscttSeq}
                   AND CMT_SEQ = #{cmtSeq}
                <trim>         
                   <if test="refrnCmtSeq == null and refrnCmtSeq == ''" >
                   AND REFRN_CMT_SEQ = #{cmtSeq}
                   </if>
                   <if test="refrnCmtSeq != null and refrnCmtSeq != ''" >
                   AND REFRN_CMT_SEQ = #{refrnCmtSeq}
                   </if>
                </trim>
                   AND CMT_ORDR_NO &gt; #{cmtOrdrNo}
                   AND CMT_DP &gt; #{cmtDp} )
    </select>
    
    <!-- 게시물 댓글 마지막 자식-->
    <select id="boardCmtMaxOrderNo" parameterType="boardVO" resultType="int">
    /*_boardWeb : board-sqlmap.xml : boardCmtMaxOrderNo */
        SELECT NVL(MAX(CMT_ORDR_NO),0)
          FROM OP_NTT_CMT
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
           AND REFRN_CMT_SEQ = #{cmtSeq}
    </select>

    <!-- 게시물 댓글 하위 자식들 OrderNo 1증가 -->
    <update id="boardCmtUpdateOrderNo" parameterType="boardVO">
    /*_board : board-sqlmap.xml : boardCmtUpdateOrderNo */
        UPDATE OP_NTT_CMT
           SET CMT_ORDR_NO = CMT_ORDR_NO + 1
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
           AND CMT_SEQ = #{cmtSeq}
           AND CMT_ORDR_NO &gt; #{cmtOrdrNo}
    </update>

	<!-- 게시물 댓글 보기 -->
	<select id="commentView" parameterType="boardCmtVO" resultType="boardCmtVO">
    /*_boardWeb : board-sqlmap.xml : commentView */
        SELECT
              A.DOMAIN_CD               AS domainCd
            , A.BBS_CD                  AS bbsCd
            , A.BBSCTT_SEQ              AS bbscttSeq
            , A.CMT_SEQ                 AS cmtSeq
            , A.MNGR_ID                 AS mngrId
            , A.REGIST_ID               AS registId
            , A.REGISTER_NM             AS registerNm
            , A.REGIST_PASSWORD         AS registPassword
            , A.USER_KEY                AS userKey
            , A.ICON_KEY                AS iconKey
            , A.NTT_CMT_CN              AS nttCmtCn
            , A.BBSCTT_EVL_SCORE        AS bbscttEvlScore
            , A.REGIST_DT               AS registDt
            , A.UPDT_DT                 AS updtDt
            , A.MNGR_DELETE_AT          AS mngrDeleteAt  
            , A.CMT_ORDR_NO             AS cmtOrdrNo
            , A.REFRN_CMT_SEQ           AS refrnCmtSeq
            , A.CMT_DP                  AS cmtDp
            , A.USER_DELETE_AT          AS userDeleteAt
            , A.BIZ_MATCHING_CMPNY_NM   AS bizMatchingCmpnyNm
            , DECRYPT(A.BIZ_MATCHING_CTTPC,'P007')    AS bizMatchingCttpc
            , DECRYPT(A.BIZ_MATCHING_EMAIL,'P008')     AS bizMatchingEmail
            , A.BIZ_MATCHING_OTHBC_AT   AS bizMatchingOthbcAt
            , A.FILE_SEQ                AS fileSeq
          FROM OP_NTT_CMT A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
           AND A.BBSCTT_SEQ = #{bbscttSeq}
           AND A.CMT_SEQ = #{cmtSeq}
    </select>

	<!-- 게시물 댓글 수정 -->
	<update id="commentUpdate" parameterType="boardCmtVO">
    /*_boardWeb : board-sqlmap.xml : commentUpdate */
        UPDATE OP_NTT_CMT
           SET REGISTER_NM              = #{registerNm}
               , REGIST_PASSWORD        = #{registPassword}
               , ICON_KEY               = #{iconKey}
               , NTT_CMT_CN             = #{nttCmtCn}
               , BBSCTT_EVL_SCORE       = #{bbscttEvlScore}
               , UPDT_ID                = #{updtId}
               , UPDT_DT                = SYS_DATETIME
               , BIZ_MATCHING_CMPNY_NM  = #{bizMatchingCmpnyNm}
               , BIZ_MATCHING_CTTPC     = ENCRYPT(#{bizMatchingCttpc},'P007')
               , BIZ_MATCHING_EMAIL     = ENCRYPT(#{bizMatchingEmail},'P008')
               , BIZ_MATCHING_OTHBC_AT  = #{bizMatchingOthbcAt}
               , FILE_SEQ               = #{fileSeq}
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
           AND CMT_SEQ = #{cmtSeq}
    </update>
    
	<!-- 게시물 삭제시 하위 댓글 삭제 -->
    <update id="commentDeleteAll" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : commentDeleteAll */
        DELETE FROM OP_NTT_CMT
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
    </update>

    <!-- 게시물 댓글 하나만 삭제 -->
    <update id="commentDelete" parameterType="boardCmtVO">
    /*_boardWeb : board-sqlmap.xml : commentDelete */
        DELETE FROM OP_NTT_CMT
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
           AND CMT_SEQ = #{cmtSeq}
    </update>

	<!-- 댓글 사용자 플래그삭제 저장 -->
    <update id="updateCmtUserDelYn" parameterType="boardCmtVO">
    /*_boardWeb : board-sqlmap.xml : updateCmtMngrDelYn */
        UPDATE OP_NTT_CMT
           SET USER_DELETE_AT = 'Y'
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
           AND CMT_SEQ = #{cmtSeq}
           AND REFRN_CMT_SEQ = COALESCE(#{refrnCmtSeq}, #{cmtSeq})
    </update>
    
    <!-- 태그이름별 전체갯수 -->
    <select id="boardTagCount" parameterType="boardTagVO" resultType="int">
    /*_boardWeb : board-sqlmap.xml : boardTagCount */
        SELECT COUNT(A.BBSCTT_SEQ) AS totalCount
          FROM OP_NTT_TAG A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
           AND A.TAG_NM = #{tagNm}
    </select>

	<!-- 태그이름별 평균갯수 -->
    <select id="boardTagAvgCount" parameterType="int" resultType="int">
    /*_boardWeb : board-sqlmap.xml : boardTagAvgCount */
        SELECT FLOOR(AVG(COUNT(A.BBSCTT_SEQ))) AS tagCntAvg
          FROM OP_NTT_TAG A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
         GROUP BY A.TAG_NM
    </select>

    <!-- 태그이름별 최대갯수 -->
    <select id="boardTagMaxCount" parameterType="int" resultType="int">
    /*_boardWeb : board-sqlmap.xml : boardTagMaxCount */
        SELECT MAX(COUNT(A.BBSCTT_SEQ)) AS tagCntMax
          FROM OP_NTT_TAG A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
         GROUP BY A.TAG_NM
    </select>
    
    <!-- 태그이름별 최소갯수 -->
    <select id="boardTagMinCount" parameterType="int" resultType="int">
    /*_boardWeb : board-sqlmap.xml : boardTagMinCount */
        SELECT MIN(COUNT(A.BBSCTT_SEQ)) AS tagCntMin
          FROM OP_NTT_TAG A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
         GROUP BY A.TAG_NM
    </select>

    <!-- 게시물별 태그 목록 -->
    <select id="boardTagList" parameterType="boardVO" resultType="String">
    /*_boardWeb : board-sqlmap.xml : boardTagList */
        SELECT A.TAG_NM AS tagNm
          FROM OP_NTT_TAG A 
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
           AND A.BBSCTT_SEQ = #{bbscttSeq}
    </select>

	<!-- 게시물별 태그 목록 -->
    <select id="boardTagListAll" parameterType="boardVO" resultType="boardTagVO">
    /*_boardWeb : board-sqlmap.xml : boardTagListAll */
        SELECT 
               A.DOMAIN_CD    AS domainCd
             , A.BBS_CD       AS bbsCd
             , A.BBSCTT_SEQ   AS bbscttSeq
             , A.TAG_NM       AS tagNm
          FROM OP_NTT_TAG A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
           AND A.BBSCTT_SEQ = #{bbscttSeq}
    </select>

    <!-- 태그 이름별 갯수 -->
    <select id="boardTagAllList" parameterType="int" resultType="boardTagVO">
    /*_boardWeb : board-sqlmap.xml : boardTagAllList */
        SELECT A.TAG_NM         AS tagNm,
               COUNT(A.TAG_NM)  AS tagCnt
          FROM OP_NTT_TAG A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
         GROUP BY A.TAG_NM
         ORDER BY A.TAG_NM
    </select>

	<!-- 태그 등록 -->
    <insert id="boardTagInsert" parameterType="boardTagVO">
    /*_boardWeb : board-sqlmap.xml : boardTagInsert */
        INSERT INTO OP_NTT_TAG (
             DOMAIN_CD
           , BBS_CD    
           , BBSCTT_SEQ
           , TAG_NM
        ) VALUES (
             #{domainCd}
           , #{bbsCd}
           , #{bbscttSeq}
           , #{tagNm}    
        )
    </insert>

    <!-- 태그 삭제 -->
    <delete id="boardTagDelete" parameterType="boardTagVO">
    /*_boardWeb : board-sqlmap.xml : boardTagDelete */
        DELETE FROM OP_NTT_TAG
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
           AND A.TAG_NM = #{tagNm}
    </delete>

	<!-- 게시물 모든 태그 삭제 -->
    <delete id="boardTagDeleteAll" parameterType="boardVO">
    /*_boardWeb : board-sqlmap.xml : boardTagDeleteAll */
        DELETE FROM OP_NTT_TAG
         WHERE DOMAIN_CD = #{domainCd}
           AND BBS_CD = #{bbsCd}
           AND BBSCTT_SEQ = #{bbscttSeq}
    </delete>
	
	<!-- 비즈매칭 댓글 선정 -->
    <update id="selectionUpdate" parameterType="boardVO" >
    /*_board : board-sqlmap.xml : selectionUpdate */
        UPDATE OP_BOARD
           SET ESTN_COLUMN5      = #{estnColumn5}
         WHERE DOMAIN_CD         = #{domainCd}
           AND BBS_CD            = #{bbsCd}
           AND BBSCTT_SEQ        = #{bbscttSeq}
    </update>
    
    <!-- 비즈매칭 댓글-게시물 보기 -->
    <select id="cmtBoardView" parameterType="boardCmtVO" resultType="boardCmtVO">
    /*_board : board-sqlmap.xml : cmtBoardView */
        SELECT 
               A.USER_KEY                   AS userKey
             , A.REGIST_ID                  AS registId
             <choose>
                 <when test="bbsCd == '1010'">
                 , (CASE
                    <!-- 선정한 댓글이 있는경우(무조건) = 완료 -->
                         WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'Y'                              THEN 'Y'
                    <!-- 선정한 댓글이 없고, 종료일이 지났을경우 = 미완료-->
                         WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &gt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL   THEN 'N'
                    <!-- 선정한 댓글이 없고, 종료일이 안지났을경우 = 대기중-->
                         WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &lt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL   THEN 'S'
                         ELSE ''
                      END)                  AS estnColumn5
                 , SUBSTR (ESTN_COLUMN5,3)  AS bizCmtSeq
                 </when>
                 <otherwise>
                     , A.ESTN_COLUMN5       AS estnColumn5
                 </otherwise>
             </choose>
             <if test="bbsCd == '1010'">
             , (CASE
                <!-- 선정한 댓글이 있는경우(무조건) = 완료 -->
                     WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'Y'                              THEN 'COM'
                <!-- 선정한 댓글이 없고, 종료일이 지났을경우 = 미완료-->
                     WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N'  AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &gt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL   THEN 'INC'
                <!-- 선정한 댓글이 없고, 종료일이 안지났을경우 = 진행중-->
                     WHEN SUBSTR (ESTN_COLUMN5,0,1) = 'N' AND TO_CHAR(SYS_DATETIME,'yyyyMMddhh24miss') &lt; ESTN_COLUMN6 AND ESTN_COLUMN6 IS NOT NULL   THEN 'PRO'
                     ELSE ''
                  END)                      AS bizProgression
              </if>
             , A.ESTN_COLUMN6               AS estnColumn6
             , A.MNGR_DELETE_AT             AS mngrDeleteAt
             , A.USER_KEY                   AS userKey
          FROM OP_BOARD A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD = #{bbsCd}
           AND A.BBSCTT_SEQ = #{bbscttSeq}
    </select>
	
	<!-- 서비스주문정보 갯수 -->
    <select id="productListCount" parameterType="java.util.Map" resultType="int">
    /*_boardWeb : board-sqlmap.xml : productListCount */
        SELECT COUNT(O.GOODS_CODE) AS totalCount
          FROM TST_GOOD_ORDR_I O, TST_GOOD_INFO_I I
         WHERE O.GOODS_CODE = I.GOODS_CODE 
           AND O.ORDRR_ID = #{ordrrId}
           AND I.MNGR_DELETE_AT ='N' 
           AND I.GOODS_ACTVTY_AT ='Y' 
           AND I.GOODS_REGIST_STTUS = 1006 
           AND O.ORDER_CNFIRM_AT = 'Y' 
           AND I.LANG_CODE = #{langCode} 
           AND O.PURCHS_NO NOT IN ( 
                        SELECT SUBSTRING(ESTN_COLUMN7,0,INSTR(ESTN_COLUMN7, '_', 1)-1 )
                        FROM  OP_BOARD
                        WHERE REGIST_ID = #{ordrrId} 
                          AND BBS_CD = #{bbsCd}  
                          AND DOMAIN_CD = #{domainCd}
                          <if test="bbscttSeq != null  and bbscttSeq != ''">
                          AND BBSCTT_SEQ != #{bbscttSeq}  
                          </if>
                            )
          <include refid="searchDynamic"/>
    </select>

    <!--  서비스주문정보 목록-->
    <select id="productOrdrList" parameterType="java.util.Map" resultType="consultOrderVO">
        /*_boardWeb : board-sqlmap.xml : productOrdrList */
          SELECT Y.* FROM (
                SELECT ROWNUM NUM, X.* FROM (
                /* 서비스 정보, 서비스주문정보 */
                SELECT
                        I.USER_ID           AS userId
                      , I.LANG_CODE         AS langCode
                      , O.GOODS_CODE        AS goodsCd  /*서비스코드*/
                      , O.PURCHS_NO         AS purchsNo /*구매번호*/
                      , I.GOODS_NM          AS goodsNm
                      , DECODE(O.PURCHS_NO,#{orderNo},1,0)         AS ctgryClCd
                   FROM TST_GOOD_ORDR_I O, TST_GOOD_INFO_I I 
                  WHERE O.GOODS_CODE = I.GOODS_CODE
                    AND O.ORDRR_ID = #{ordrrId}
                    AND I.MNGR_DELETE_AT ='N' 
                    AND I.GOODS_ACTVTY_AT ='Y' 
                    AND I.GOODS_REGIST_STTUS = 1006 
                    AND O.ORDER_CNFIRM_AT = 'Y' 
                    AND I.LANG_CODE = #{langCode} 
                    AND NOT O.PURCHS_NO IN ( 
                        SELECT SUBSTRING(ESTN_COLUMN7,0,INSTR(ESTN_COLUMN7, '_', 1)-1 )
                        FROM  OP_BOARD
                        WHERE REGIST_ID = #{ordrrId} 
                          AND BBS_CD = #{bbsCd}  
                          AND DOMAIN_CD = #{domainCd}
                          <if test="bbscttSeq != null  and bbscttSeq != ''">
                          AND BBSCTT_SEQ != #{bbscttSeq}  
                          </if>
                          )
			       <include refid="searchDynamic"/>                      
                  ORDER BY O.PURCHS_NO DESC     
                   ) X WHERE ROWNUM &lt;= #{pagingEndNum}
                ) Y WHERE NUM &gt;= #{pagingStartNum}         
    </select>
    
    <!-- 게시물 댓글 목록 전체 -->
    <select id="bizCommentCheck" parameterType="boardCmtVO" resultType="int">
    /*_boardWeb : board-sqlmap.xml : bizCommentCheck */
        SELECT COUNT(A.CMT_SEQ)
          FROM OP_NTT_CMT A
         WHERE A.DOMAIN_CD = #{domainCd}
           AND A.BBS_CD= #{bbsCd}
           AND A.BBSCTT_SEQ = #{bbscttSeq}
           AND A.USER_KEY = #{userKey}
    </select>
    
    <!-- 카테고리 사용하고있는 사용자 목록 => 해당카테고리 서비스의 서비스 담당자 목록 -->
    <select id="userCategoryList" parameterType="boardVO" resultType="registerUserVO">
    /*_boardWeb.userCategoryList */
    <!-- 
    SELECT 
          USER_NM  AS userNm 
        , DECRYPT(EMAIL,'P008') AS email
        , USER_TY_CD  AS userTyCd 
        , DECRYPT(MBTLNUM,'P007') AS telno
    FROM OP_USER
    WHERE USER_ID IN (
	         SELECT DISTINCT USER_ID
	         FROM TUM_ITST_CATE_I 
	         WHERE LANG_CODE = '00'
	           AND CTGRY_CODE IN (<foreach collection="categorys" item="item" separator=", ">#{item}</foreach>)
	         )
	-->
	SELECT USER_ID AS userId
		 , GOODS_CHARGER_NM AS userNm
	     , DECRYPT(GOODS_CHARGER_EMAIL,'P008') AS email
	     , DECRYPT(GOODS_CHARGER_MBTLNUM,'P007') AS telno
	  FROM TST_GOOD_INFO_I
	 WHERE LANG_CODE = '00'
	   AND goods_regist_sttus = 1006
	   AND MNGR_DELETE_AT='N' 
	   AND GOODS_CODE IN (SELECT A.GOODS_CODE 
				            FROM TST_GOOD_CATE_I A, TST_CATE_MGMT_M B
	                       WHERE A.CTGRY_CODE = B.CTGRY_CODE 
	                         AND B.CTGRY_DELETE_AT = 'N'
	                         AND A.CTGRY_CODE IN (<foreach collection="categorys" item="item" separator=", ">#{item}</foreach>)
	                       GROUP BY A.GOODS_CODE )
	   AND DECRYPT(GOODS_CHARGER_EMAIL,'P008') IS NOT NULL 
	 GROUP BY DECRYPT(GOODS_CHARGER_EMAIL,'P008')
    </select>
    
    <!-- 희망답변자 이메일발송정보 목록 -->
    <select id="selectCtgryUserList" parameterType="boardVO" resultType="registerUserVO">
    	/* _boardWeb.selectCtgryUserList */
	    SELECT USER_ID AS userId
	    	 , USER_NM AS userNm
		     , DECRYPT(EMAIL,'P008') AS email
		     , NVL(DECRYPT(MBTLNUM,'P007'),'') AS telno
		  FROM OP_USER
		 WHERE LANG_CODE = '00'
		   AND USER_STTUS_CD = '1001'
		   AND USER_TY_CD = '2002'
		   AND USER_ID IN (<foreach collection="ctgryUserIds" item="item" separator=", ">#{item}</foreach>)
		   AND DECRYPT(EMAIL,'P008') IS NOT NULL 
		 GROUP BY DECRYPT(EMAIL,'P008')
    </select>

    <!-- 게시물 등록자 정보조회 -->
    <select id="userBoardSelect" parameterType="boardVO" resultType="boardVO">
        /*_boardWeb : board-sqlmap.xml : userBoardSelect */
        <choose>
            <when test="bbsCd == '1010'">
                <if test="cmtSeq == null or cmtSeq == '' ">
                SELECT USER_NM                 AS userNm
                     , DECRYPT(EMAIL,'P008')   AS email
                     , USER_TY_CD              AS userTyCd
                     , DECRYPT(MBTLNUM,'P007') AS telNo
                  FROM OP_USER
                 WHERE USER_KEY IN (SELECT USER_KEY
                                      FROM OP_BOARD
                                     WHERE DOMAIN_CD = #{domainCd}
                                       AND BBS_CD = #{bbsCd}
                                       AND BBSCTT_SEQ = #{bbscttSeq})
                </if>
                <!-- 비즈매칭 댓글 입력시 입력된 사용자 정보 -->
                <if test="cmtSeq != null and cmtSeq != '' ">
                SELECT A.USER_NM                            AS userNm 
                     , DECRYPT(B.BIZ_MATCHING_EMAIL,'P008') AS email
                     , USER_TY_CD                           AS userTyCd 
                     , DECRYPT(B.BIZ_MATCHING_CTTPC,'P007') AS telNo 
                  FROM OP_USER A
                     , OP_NTT_CMT B
                 WHERE A.USER_KEY = B.USER_KEY
                   AND B.DOMAIN_CD = #{domainCd}
                   AND B.BBS_CD = #{bbsCd}
                   AND B.BBSCTT_SEQ = #{bbscttSeq}
                   AND B.CMT_SEQ = #{cmtSeq}
                </if>
            </when>
            <otherwise>
                SELECT USER_NM                 AS userNm
                     , DECRYPT(EMAIL,'P008')   AS email
                     , USER_TY_CD              AS userTyCd
                     , DECRYPT(MBTLNUM,'P007') AS telNo
                  FROM OP_USER
                 WHERE 1 = 1
                <if test="cmtSeq == null or cmtSeq == '' ">
                   AND USER_KEY IN (SELECT USER_KEY
                                      FROM OP_BOARD
                                     WHERE DOMAIN_CD = #{domainCd}
                                       AND BBS_CD = #{bbsCd}
                                       AND BBSCTT_SEQ = #{bbscttSeq})
                </if>
                <if test="cmtSeq != null and cmtSeq != '' ">
                   AND USER_KEY IN (SELECT USER_KEY
                                      FROM OP_NTT_CMT
                                     WHERE DOMAIN_CD = #{domainCd}
                                       AND BBS_CD = #{bbsCd}
                                       AND BBSCTT_SEQ = #{bbscttSeq}
                                       AND CMT_SEQ = #{cmtSeq})
                </if>
            </otherwise>
        </choose>
    </select>

    <!-- 관리자 정보조회 -->
    <select id="mgrInfo" parameterType="mgrVO" resultType="mgrVO">
    /*_boardWeb : board-sqlmap.xml : mgrInfo */
      SELECT 
             EMAIL AS email 
           , MNGR_NM mngrNm 
      FROM OP_MNGR
      WHERE USE_YN = 'Y'
        AND EMAIL_NTICE_YN = 'N'
        AND LENGTH(EMAIL) > 0
    </select>
    
	<!-- 부류코드 2Depth 조회 -->
    <select id="AditCtgList" parameterType="boardVO" resultType="boardVO">
    /*_board : board-sqlmap.xml : AditCtgList */
        SELECT 
             CTG_NM       AS aditCtgNm
           , ADIT_CTG_CD  AS aditCtgCd
            FROM OP_BOARD_ADIT_CTG
            WHERE DOMAIN_CD = #{domainCd} 
              AND BBS_CD = #{bbsCd} 
              AND CTG_CD = #{ctgCd}
            ORDER BY CTG_ORDR_NO ASC
    </select>

    <!-- 부류코드 2Depth 수정 -->
    <update id="othbcAtUpdateAction" parameterType="boardVO">
    /*_board : board-sqlmap.xml : othbcAtUpdateAction */
        UPDATE OP_BOARD
           SET OTHBC_AT         = #{othbcAt}  
         WHERE DOMAIN_CD        = #{domainCd}
           AND BBS_CD           = #{bbsCd}
           AND BBSCTT_SEQ       = #{bbscttSeq}
    </update>

</mapper>